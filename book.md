# Hi6 로봇제어기 기능설명서 - 멀티태스킹

{% hint style="warning" %}
본 제품 설명서에서 제공되는 정보는 현대로보틱스의 자산입니다.

현대로보틱스의 서면에 의한 동의 없이 전부 또는 일부를 무단 전재 및 재배포할 수 없으며, 제3자에게 제공되거나 다른 목적에 사용할 수 없습니다.



본 설명서는 사전 예고 없이 변경될 수 있습니다.



**Copyright ⓒ 2020 by Hyundai Robotics**
{% endhint %}
# 1. 개요

# 1.1 멀티태스킹 기능에 대하여

Hi6 제어기는 총 8개의 프로그램(JOB 파일)을 동시에 독립적으로 실행할 수 있으며, 이러한 독립된 동작방식에 의해 수행되는 멀티태스킹 제어를 “**멀티태스킹 기능**”이라 합니다.

멀티태스크 기능을 이용하면 로봇 제어 프로그램을 실행하면서 동시에 다른 디바이스를 제어하는 프로그램을 실행할 수 있습니다. 이때 로봇 제어와 다른 디바이스 제어를 서로 독립적으로 수행할 수 있고 필요한 경우에는 로봇과 다른 디바이스가 서로 동기된 상태로 협업작업을 할 수도 있어 복잡하고 어려운 응용작업을 수행할 수 있는 이점이 있습니다.

아래의 그림 1-1은 싱글태스킹 구조입니다. 여기서는 1개의 태스크만 존재하여 2개 이상의 프로그램을 동시에 독립적으로 실행 할 수 없습니다. 이어서 설명할 멀티태스킹 구조와 비교해 보면 메인태스크만 존재하고 서브태스크는 없다고 생각하면 됩니다.

![그림 1-1 싱글태스킹 구조](<../_assets/image_1.png>)

아래의 그림 1‑2은 멀티태스킹 구조입니다. 최대 8개의 태스크가 동시 실행 가능하기 때문에 각 태스크 당 1개의 프로그램 (JOB 파일)을 할당하여 최대 8개의 프로그램(JOB 파일)을 독립적으로 동시에 실행할 수 있습니다. 8개의 태스크를 동시에 수행함으로써 다수의 디바이스 제어를 독립적으로 수행할 수 있습니다.

![그림 1‑2 멀티태스킹 구조](<../_assets/image_2.png>)

프로그램을 실행하는 8개의 태스크들의 명칭은 아래와 같습니다.

* 메인태스크
* 서브태스크 1 \~ 7

메인태스크는 JOB 프로그램을 수행하기 위해서 항상 기본으로 생성되고 존재하며, 서브태스크는 필요에 따라 생성과 소멸이 가능합니다. 아래의 그림 1-3은 서브태스크 생성 구조입니다. 서브태스크의 생성은 프로그램에서 taskstart 명령문을 실행할 때 자동으로 이루어집니다. 서브태스크의 소멸은 각각의 서브태스크 프로그램에서 end 명령문이 실행될 때 자동으로 이루어집니다.

![그림 1‑3 서브태스크 생성
](<../_assets/image_3.png>)
# 1.2 용어 설명

본 설명서에서 사용하는 용어에 대한 설명은 아래의 표와 같습니다.

<mark style="color:green;">표 1‑1 멀티태스크 용어 설명</mark>

| 　　　　　　　　용어                                                              | 　　　　　　　　　　설명                                                                                                                                     |
| ----------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------ |
| 프로그램 (JOB 파일)                                                           | <p>- 제어기의 저장메모리에 저장되어 있는 작업 프로그램<br>(예시: 0001.JOB, 0002.JOB, 1001.JOB 등 제어기에 저장된 JOB 파일을 지칭합니다.)</p>                                             |
| <p>메인태스크</p><p>(Main Task)</p><p>서브태스크 1 ~ 7</p><p>(Sub Task 1 ~ 7)</p> | <p>- 작업 프로그램을 로드해서 실행할 수 있는 로봇제어기의 작업프로그램 실행기</p><p>- 총 8개의 태스크가 있고 각 태스크는 한번에 1개의 프로그램만 로드와 실행을 할 수 있습니다.</p>                                   |
| <p>메인태스크 프로그램</p><p>서브태스크 프로그램</p>                                      | <p>- 태스크에 할당된 특정 작업 프로그램을 지칭합니다.<br>(예시: 메인태스크에서 0001.JOB을 로드한 경우 메인태스크 프로그램은 0001.JOB 입니다.)</p><p>- 프로그램은 메인태스크 또는 서브태스크로 할당되어야만 실행이 가능합니다.</p> |
# 2. 관련 기능

# 2.1 명령문

# 2.1.1 taskstart

taskstart 명령문은 서브태스크를 생성, 서브태스크에 특정 JOB 프로그램을 할당, 서브태스크 프로그램을 기동하는 역할을 수행합니다. taskstart는 서브태스크를 생성할 때 이용합니다.

taskstart 명령어는 『**명령입력**』→『**기타**』→『**taskstart**』 순서대로 선택해서 입력을 할 수 있습니다.

```
taskstart sub=<서브태스크 번호>,job=<프로그램 번호>
```

|    **항목**    | 　　　　　　　　　　**내용**                                                   |
| :----------: | ------------------------------------------------------------------ |
| **서브태스크 번호** | 생성할 서브태스크 번호를 지정(1\~7)                                             |
|  **프로그램 번호** | 생성된 서브태스크에서 실행할 프로그램을 지정(1\~9999)                                  |
|   **사용 예시**  | <p>taskstart sub=1,job=11</p><p>(서브 태스크 1에 0011.JOB 를 할당하여 수행)</p> |

![그림 2 1 taskstart 명령어 사용 예시](<../../_assets/image_5.png>)

![그림 2 2 서브태스크 생성과 종료대기 예시](<../../_assets/image_7.png>)

주의할 점으로 생성하고자 하는 서브태스크 번호는 자기 자신의 번호가 아닌 다른 서브태스크 번호이어야 합니다. 이외에도 taskstart 명령은 아래에서 설명하는 경우에는 오류 상황으로 적용이 불가능하니 주의가 필요합니다.

taskstart를 이용하여 생성하고자 하는 서브태스크가 이미 생성되어 실행중인 경우에 다른 프로그램을 해당 서브태스크에서 생성하면 오류가 발생합니다. 아래의 예시를 참고하시기 바랍니다.

*   <mark style="color:green;">**서브태스크 실행 중 다른 프로그램 할당과 실행 오류**</mark>

    ```
    taskstart sub=1,job=11
    # subtask 1 was started
    taskstart sub=1,job=12
    …
    ```
# 2.1.2 taskwait

taskwait 명령문은 서브태스크의 소멸을 대기하는 역할을 수행합니다. 일반적으로 서브태스크 소멸은 해당 서브태스크 프로그램의 end 명령문 실행에 의해 자동으로 처리됩니다. 작업을 수행 중에 다른 서브태스크의 완료를 대기하였다가 다음 동작을 수행할 때 이용합니다.

```
taskwait sub=<서브태스크 번호>
```

|    **항목**    | 　　　　　　　　　　**내용**                                  |
| :----------: | ------------------------------------------------- |
| **서브태스크 번호** | 소멸을 대기하는 서브태스크 번호를 지정(1\~7)                       |
|   **사용 예시**  | <p>taskwait sub=1</p><p>(서브태스크 1의 소멸을 대기합니다.)</p> |
# 2.1.3 tasksync

tasksync 명령문은 태스크들 사이의 동기를 맞추는 역할을 수행합니다. 일반적으로 2개 이상의 로봇이 협조 작업을 위해서는 동기가 필수적인데, 이 경우 태스크간 동기 시작 시점을 맞출 때 편리하게 사용할 수 있습니다. 메인태스크와 서브태스크가 작업을 수행하다가 특정 지점에서 동시에 작업을 시작하고자 할 때 유용하게 이용할 수 있습니다.

```
tasksync id=<식별자>,no=<동일 id의 실행 갯수>
```

|     **항목**     | 　　　　　　　　　　**내용**                                                                                                                                                                                                                   |
| :------------: | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|     **식별자**    | <p>1~32 로 식별자를 지정</p><p>동기할 지점은 프로그램 내에서 여러 개 설정할 수 있으며 이를 구별하기 위해서 사용합니다.</p>                                                                                                                                                     |
| **동기할 태스크 개수** | <p>2~8로 동기할 태스크의 개수를 지정</p><p>tasksync 명령어가 실행된 태스크 개수와 일치할 때까지 대기합니다.</p>                                                                                                                                                         |
|    **사용 예시**   | <p># 메인태스크 프로그램</p><p>print ”maintask”</p><p>taskstart sub=1, job=11</p><p>…</p><p><mark style="background-color:green;">tasksync id=1,no=2</mark></p><p>print ”sync with subtask 1”</p><p> </p><p>(태스크 ID는 1, 동기할 태스크 개수는 2개)</p> |
|                | <p># 서브 태스크 1 프로그램</p><p>print ”subtask 1”</p><p>…</p><p><mark style="background-color:green;">tasksync id=1,no=2</mark></p><p>print ”sync with maintask”</p><p> </p><p>(태스크 ID는 1, 동기할 태스크 개수는 2개)</p>                            |
# 2.2 모니터링

# 2.2.1 멀티태스킹 상태

『**창선택**』 → 『**멀티태스킹**』에서 각각의 태스크에 할당된 프로그램 번호를 포함하여 각종 상태를 확인할 수 있습니다.

![ 그림 2‑4 멀티태스킹 모니터링 창](<../../_assets/image_6.png>)
# 2.3 서브태스크 생성

# 2.3.1 자동 생성

메인태스크 프로그램 또는 서브태스크 프로그램 내에서 taskstart 명령문 실행에 의해 원하는 서브태스크에 프로그램이 할당되어 서브태스크가 자동 생성됩니다.
# 2.3.2 수동 생성

사용자가 TP 조작을 통해서 원하는 서브태스크에 프로그램을 할당하고 실행시키는 방법입니다. 수동 생성 절차는 다음과 같습니다.

『**창선택**』 → 『**멀티태스킹**』창에서 원하는 서브태스크로 커서를 이동하여 『**편집**』 버튼으로  프로그램 선택

![그림 2‑5 서브태스크 수동생성](<../../_assets/image_4.png>)
# 2.4 서브태스크 소멸

# 2.4.1 자동 소멸

서브태스크의 프로그램에서 end 명령문이 실행되면 서브태스크는 자동 소멸됩니다.
# 2.4.2 수동 소멸

서브태스크를 수동으로 소멸시키고 클리어하는 것은 모니터링 창에서 프로그램 번호를 0으로 선택하는 방식으로 할 수 있습니다. 절차는 다음과 같습니다.

『**창선택**』 → 『**멀티태스크**』에서 원하는 서브태스크로 커서를 이동하여 『**편집**』 버튼으로 프로그램 번호를 ‘**0**’선택

이외에도 수동모드에서 메인태스크의 프로그램을 다시 선택하면 모든 서브태스크가 소멸됩니다.

![그림 2 6 멀티태스크 수동 소멸](../../_assets/image.png)

# 2.5 스텝 전/후진

생성된 모든 태스크를 동시에 스텝 전/후진을 하거나 현재 선택된 태스크만 스텝 전/후진을 하고자 할 때에는 아래 표에 정리된 키를 이용하면 됩니다. 스텝 전/후진 키를 선택할 때 메인태스크와 서브태스크의 스텝 동작은 아래 표와 같습니다.

|               **동작**               | 　　　　　　　　　　**내용**       |
| :--------------------------------: | ---------------------- |
|       \[**FWD**]/\[**BWD**]키       | 생성된 모든 태스크 동시에 전/후진 실행 |
| \[**CTRL**]+\[**FWD**]/\[**BWD**]키 | 현재 선택된 태스크만 전/후진 실행    |
# 2.6 기동 처리

태스크를 실행하려면 자동모드에서 ‘**MOTOR ON**’, ‘**START**’를 활성화하거나 수동모드에서 ‘**MOTOR ON**’을 활성화 시키고 \[**FWD**] 키를 선택하면 됩니다. 이외에 명령문 독립실행을 통해서 외부 신호와 연계해 서브태스크를 실행할 수도 있습니다.
# 2.7 정지 처리

멀티 태스크 동작 중에 T/P의 정지 버튼을 누르거나 외부의 정지 신호가 입력되면 모든 태스크는 정지됩니다.
# 2.8 기동/정지 램프

티치펜던트의 기동/정지 램프는 태스크의 동작 상태를 표시하며 그 상태는 아래의 표와 같습니다.

|        **동작**       | 　　　　　　　　　　**내용**  |
| :-----------------: | ----------------- |
| 기동램프 ON  / 정지램프 OFF | 하나의 태스크라도 기동중인 경우 |
|  기동램프 OFF / 정지램프 ON | 모든 태스크가 정지된 경우    |
